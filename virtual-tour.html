<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TWB Platform - Virtual Tour</title>
  <style>
    /* Reset and Base Styles */
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
    }

    /* Navbar Styles */
    .resources-menu a:hover,
    .user-menu a:hover {
      background: #f8f8f8;
    }

    .nav-dropdown.open .resources-menu,
    .user-dropdown.open .user-menu {
      display: block !important;
    }

    /* Tour Overlay */
    .tour-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9998;
      display: none;
    }

    .tour-overlay.active {
      display: block;
    }

    /* Tour Modal */
    .tour-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      z-index: 9999;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      display: none;
    }

    .tour-modal.active {
      display: block;
      animation: modalFadeIn 0.3s ease;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translate(-50%, -45%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    .tour-modal h2 {
      font-size: 28px;
      font-weight: 600;
      margin: 0 0 16px 0;
      color: #1a1a1a;
    }

    .tour-modal p {
      font-size: 16px;
      line-height: 1.6;
      color: #4a4a4a;
      margin: 0 0 24px 0;
    }

    .tour-modal .tip {
      font-size: 14px;
      color: #666;
      font-style: italic;
      margin-top: 12px;
    }

    /* Tour Buttons */
    .tour-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 32px;
    }

    .tour-btn-primary {
      background: #f58220;
      color: white;
      border: none;
      padding: 12px 28px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .tour-btn-primary:hover {
      background: #e07515;
    }

    .tour-btn-secondary {
      background: transparent;
      color: #666;
      border: 1px solid #ddd;
      padding: 12px 28px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tour-btn-secondary:hover {
      border-color: #999;
      color: #333;
    }

    .tour-btn-text {
      background: none;
      border: none;
      color: #666;
      font-size: 14px;
      cursor: pointer;
      text-decoration: underline;
      padding: 0;
    }

    .tour-btn-text:hover {
      color: #333;
    }

    /* Spotlight */
    .tour-spotlight {
      position: absolute;
      border: 3px solid #f58220;
      border-radius: 8px;
      box-shadow: 0 0 0 4000px rgba(0, 0, 0, 0.7);
      z-index: 9997;
      pointer-events: none;
      display: none;
      transition: all 0.3s ease;
    }

    .tour-spotlight.active {
      display: block;
    }

    /* Tooltip */
    .tour-tooltip {
      position: absolute;
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      z-index: 9999;
      display: none;
    }

    .tour-tooltip.active {
      display: block;
      animation: tooltipFadeIn 0.3s ease;
    }

    @keyframes tooltipFadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .tour-tooltip h3 {
      font-size: 20px;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: #1a1a1a;
    }

    .tour-tooltip p {
      font-size: 15px;
      line-height: 1.5;
      color: #4a4a4a;
      margin: 0;
    }

    .tour-tooltip .tip {
      font-size: 14px;
      color: #666;
      font-style: italic;
      margin-top: 12px;
      display: block;
    }

    /* Progress Indicator */
    .tour-progress {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 24px;
    }

    .tour-progress-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ddd;
      transition: all 0.3s;
    }

    .tour-progress-dot.active {
      background: #f58220;
      width: 24px;
      border-radius: 4px;
    }

    /* Skip Button */
    .tour-skip {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      color: #666;
      font-size: 14px;
      cursor: pointer;
      padding: 4px 8px;
    }

    .tour-skip:hover {
      color: #333;
    }

    /* Back Button */
    .tour-back {
      margin-right: auto;
    }
  </style>
</head>
<body>

<!-- TWB Navigation Bar -->
<nav style="background: white; border-bottom: 1px solid #e0e0e0; padding: 0 20px; position: sticky; top: 0; z-index: 1000;">
  <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; height: 60px;">

    <!-- Left Side: Logo and Main Nav -->
    <div style="display: flex; align-items: center; gap: 30px;">
      <!-- Logo -->
      <div style="display: flex; align-items: center; gap: 8px;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="#F58220" />
          <path d="M2 17L12 22L22 17" stroke="#F58220" stroke-width="2" />
        </svg>
        <span style="font-weight: 600; font-size: 16px; color: #1a1a1a;">Translators without Borders</span>
      </div>

      <!-- Main Navigation -->
      <div style="display: flex; gap: 20px; align-items: center;">
        <a href="#" style="text-decoration: none; color: #2C5F9C; font-weight: 500; font-size: 15px;">Home</a>

        <!-- Resources Dropdown -->
        <div class="nav-dropdown" style="position: relative;">
          <button class="resources-toggle" style="background: none; border: none; color: #F58220; font-weight: 500; font-size: 15px; cursor: pointer; display: flex; align-items: center; gap: 4px; padding: 8px 12px;">
            Resources
            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path d="M6 8L2 4h8l-4 4z" />
            </svg>
          </button>

          <!-- Resources Dropdown Menu -->
          <div class="resources-menu" style="position: absolute; top: 100%; left: 0; background: white; border: 1px solid #e0e0e0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 280px; margin-top: 8px; display: none; z-index: 1001;">
            <a href="#" style="display: flex; align-items: start; gap: 12px; padding: 16px; text-decoration: none; color: #1a1a1a; border-bottom: 1px solid #f0f0f0;">
              <span style="font-size: 20px;">üéì</span>
              <div>
                <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Community Forum</div>
                <div style="font-size: 13px; color: #666;">Ask questions and talk with other community members</div>
              </div>
            </a>
            <a href="#" style="display: flex; align-items: start; gap: 12px; padding: 16px; text-decoration: none; color: #1a1a1a; border-bottom: 1px solid #f0f0f0;">
              <span style="font-size: 20px;">üìö</span>
              <div>
                <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Learning Center</div>
                <div style="font-size: 13px; color: #666;">Courses and training</div>
              </div>
            </a>
            <a href="#" style="display: flex; align-items: start; gap: 12px; padding: 16px; text-decoration: none; color: #1a1a1a; border-bottom: 1px solid #f0f0f0;">
              <span style="font-size: 20px;">üìñ</span>
              <div>
                <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Community Library</div>
                <div style="font-size: 13px; color: #666;">Instructions, guidelines and reference material</div>
              </div>
            </a>
            <a href="#" class="platform-tour-link" style="display: flex; align-items: start; gap: 12px; padding: 16px; text-decoration: none; color: #F58220; border-top: 1px solid #f0f0f0;">
              <span style="font-size: 20px;">üéØ</span>
              <div>
                <div style="font-weight: 600; font-size: 15px;">Platform Tour</div>
                <div style="font-size: 13px; color: #666;">Learn about the new features</div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side: User Menu and Feedback -->
    <div style="display: flex; align-items: center; gap: 16px;">

      <!-- User Profile Dropdown -->
      <div class="user-dropdown" style="position: relative;">
        <button class="user-toggle" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; padding: 8px 12px;">
          <div style="width: 32px; height: 32px; border-radius: 50%; background: #F58220; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
            AK
          </div>
          <span style="color: #2C5F9C; font-weight: 500; font-size: 14px;">ahmad.konainah</span>
          <svg width="12" height="12" viewBox="0 0 12 12" fill="#2C5F9C">
            <path d="M6 8L2 4h8l-4 4z" />
          </svg>
        </button>

        <!-- User Dropdown Menu -->
        <div class="user-menu" style="position: absolute; top: 100%; right: 0; background: white; border: 1px solid #e0e0e0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-width: 180px; margin-top: 8px; display: none; z-index: 1001;">
          <a href="#" style="display: block; padding: 12px 16px; text-decoration: none; color: #1a1a1a; font-size: 14px; border-bottom: 1px solid #f0f0f0;">
            Profile
          </a>
          <a href="#" style="display: block; padding: 12px 16px; text-decoration: none; color: #1a1a1a; font-size: 14px; border-bottom: 1px solid #f0f0f0;">
            My Tasks
          </a>
          <a href="#" style="display: block; padding: 12px 16px; text-decoration: none; color: #1a1a1a; font-size: 14px;">
            Log out
          </a>
        </div>
      </div>

      <!-- Feedback Button -->
      <button style="background: #FFF3E0; border: 1px solid #FFE0B2; color: #F58220; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 6px;">
        <span style="font-size: 16px;">üí≠</span>
        Feedback?
      </button>
    </div>
  </div>
</nav>

<!-- Demo Page Content -->
<div style="padding: 40px 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 1400px; margin: 0 auto; background: #f5f5f5;">

  <h1 style="margin-bottom: 30px; color: #1a1a1a;">Welcome to Your Dashboard</h1>

  <!-- Available Tasks Section -->
  <div class="available-tasks" style="margin-bottom: 30px;">
    <div style="border: 1px solid #ddd; border-radius: 12px; padding: 30px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: #333;">Available Tasks</h2>
        <a href="#" style="color: #F58220; text-decoration: none; font-weight: 500; font-size: 14px;">Browse All Tasks ‚Üí</a>
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        <div style="border: 1px solid #eee; padding: 20px; border-radius: 8px; background: #fafafa;">
          <div style="margin-bottom: 12px;">
            <span style="background: #4CAF50; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">TRANSLATION</span>
            <span style="background: #2196F3; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500; margin-left: 6px;">8322 words</span>
          </div>
          <h3 style="color: #F58220; margin: 10px 0; font-size: 16px;">1.09 INEE Minimum Standards 2024 [FINAL DRAFT]</h3>
          <p style="color: #666; font-size: 14px; margin: 8px 0;">Languages: English, US ‚Üí Hebrew</p>
          <button style="margin-top: 12px; background: #2C5F9C; color: white; border: none; padding: 10px 20px; border-radius: 6px; width: 100%; cursor: pointer; font-weight: 500;">View Task</button>
        </div>
        <div style="border: 1px solid #eee; padding: 20px; border-radius: 8px; background: #fafafa;">
          <div style="margin-bottom: 12px;">
            <span style="background: #4CAF50; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">TRANSLATION</span>
            <span style="background: #2196F3; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500; margin-left: 6px;">8343 words</span>
          </div>
          <h3 style="color: #F58220; margin: 10px 0; font-size: 16px;">1.07 INEE Minimum Standards 2024 [FINAL DRAFT]</h3>
          <p style="color: #666; font-size: 14px; margin: 8px 0;">Languages: English, US ‚Üí Hebrew</p>
          <button style="margin-top: 12px; background: #2C5F9C; color: white; border: none; padding: 10px 20px; border-radius: 6px; width: 100%; cursor: pointer; font-weight: 500;">View Task</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Community Sidebar Section -->
  <div class="community-sidebar" style="margin-bottom: 30px;">
    <div style="border: 1px solid #ddd; border-radius: 12px; padding: 30px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
      <h2 style="margin-top: 0; color: #333; font-size: 20px;">Community Survey</h2>
      <p style="color: #666; line-height: 1.6;">We want to hear from you! Take our annual Community Survey and help shape future opportunities and support for volunteers. It's anonymous and only takes 7-10 minutes.</p>
      <button style="padding: 12px 24px; background: #F58220; color: white; border: none; border-radius: 6px; cursor: pointer; width: 100%; font-weight: 500; margin-top: 12px;">
        üìù Submit Response
      </button>
    </div>
    <div style="border: 1px solid #ddd; border-radius: 12px; padding: 30px; background: white; margin-top: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
      <h2 style="margin-top: 0; color: #333; font-size: 20px;">Feedback & Suggestions</h2>
      <p style="color: #666; line-height: 1.6;">Please share your feedback with our team to help fix any issues and deliver a better experience to our community.</p>
      <button style="padding: 12px 24px; background: #F58220; color: white; border: none; border-radius: 6px; cursor: pointer; width: 100%; font-weight: 500; margin-top: 12px;">
        üì¢ Submit Feedback
      </button>
    </div>
  </div>

  <!-- Task Details Container -->
  <div class="task-details-container" style="margin-bottom: 30px;">
    <div style="border: 1px solid #ddd; border-radius: 12px; padding: 30px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
      <h2 style="margin-top: 0; color: #333;">Task Details</h2>
      <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
        <div>
          <h3 style="color: #F58220; margin-top: 0;">Basics of Humanitarian Interpreting</h3>
          <div style="margin: 16px 0;">
            <span style="background: #E91E63; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500; margin-right: 6px;">COURSE</span>
            <span style="background: #2196F3; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">60 minutes</span>
          </div>
          <p style="color: #666; margin: 12px 0;"><strong>Language:</strong> English (Complete)</p>
          <p style="color: #666; margin: 12px 0;"><strong>Completed:</strong> 2023-11-02 üïê 10:43:00</p>
          <p style="color: #666; margin: 12px 0;"><strong>Due by:</strong> 2025-04-15 üïê 21:46:00</p>
          <p style="color: #666; margin: 12px 0;"><strong>Region:</strong> Asia/Beirut or earlier, if possible</p>
        </div>
        <div style="background: #f8f8f8; padding: 20px; border-radius: 8px;">
          <h4 style="margin-top: 0; margin-bottom: 16px;">Filter Available Tasks:</h4>
          <select style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
            <option>Any Task Type</option>
            <option>Translation</option>
            <option>Review</option>
            <option>Course</option>
          </select>
          <select style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
            <option>In Progress</option>
            <option>Complete</option>
            <option>Available</option>
          </select>
          <select style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
            <option>Created Time, Newest First</option>
            <option>Due Date</option>
            <option>Word Count</option>
          </select>
          <button style="width: 100%; padding: 12px; background: #F58220; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; margin-top: 16px;">
            üîç Filter Task Stream
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Container -->
  <div class="profile-container" style="margin-bottom: 30px;">
    <div style="border: 1px solid #ddd; border-radius: 12px; padding: 30px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
        <h2 style="margin: 0; color: #333;">Your Profile</h2>
        <button style="padding: 8px 16px; background: #F58220; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">
          ‚úèÔ∏è Edit Profile Details
        </button>
      </div>
      <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 30px; align-items: start;">
        <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #F58220 0%, #E07515 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: 600;">
          AK
        </div>
        <div>
          <h3 style="margin: 0 0 8px 0; color: #1a1a1a;">Ahmad Konainah</h3>
          <p style="color: #666; margin: 5px 0;"><strong>Location:</strong> Beirut</p>
          <p style="color: #666; margin: 5px 0;"><strong>Native in:</strong> Arabic - SYRIAN ARAB REPUBLIC (ar - SY)</p>
          <p style="color: #F58220; margin: 5px 0; font-weight: 600;">
            <strong>65,286</strong> words donated | <strong>1</strong> hours donated
          </p>
          <p style="color: #666; margin: 12px 0 5px 0;"><strong>Language Pair(s):</strong></p>
          <p style="color: #666; margin: 5px 0;">English ‚Üî Arabic, Modern Standard (TWB Translator)</p>
        </div>
        <div style="background: #FFF3E0; padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #FFE0B2;">
          <div style="font-size: 48px; margin-bottom: 8px;">üèÜ</div>
          <h4 style="margin: 0 0 8px 0; color: #F58220;">Recognition Points</h4>
          <p style="font-size: 32px; font-weight: bold; margin: 0; color: #1a1a1a;">65,286</p>
          <p style="font-size: 12px; color: #666; margin: 8px 0 0 0;">Words Donated</p>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- TOUR OVERLAY -->
<div class="tour-overlay" id="tourOverlay"></div>

<!-- TOUR SPOTLIGHT -->
<div class="tour-spotlight" id="tourSpotlight"></div>

<!-- TOUR MODAL -->
<div class="tour-modal" id="tourModal">
  <button class="tour-skip" id="tourSkip">Skip</button>
  <div id="tourContent"></div>
</div>

<!-- TOUR TOOLTIP -->
<div class="tour-tooltip" id="tourTooltip">
  <h3 id="tooltipTitle"></h3>
  <p id="tooltipBody"></p>
  <div class="tour-buttons" id="tooltipButtons"></div>
  <div class="tour-progress" id="tooltipProgress"></div>
</div>

<script>
class VirtualTour {
  constructor() {
    this.currentStep = 0;
    this.totalSteps = 6;
    this.isActive = false;

    this.steps = [
      {
        type: "modal",
        title: "Welcome to Your New Home!",
        body:
          "We've redesigned your dashboard to make finding and completing tasks easier. Let us show you what's changed.",
        buttons: [
          { text: "Show Me Around", action: "next", type: "primary" },
          { text: "I'll explore on my own", action: "skip", type: "text" }
        ]
      },
      {
        type: "spotlight",
        target: ".available-tasks",
        title: "Your Tasks, Front and Center",
        body:
          'See translation opportunities matched to your skills right on your homepage. Word counts and task progress are shown upfront. Click "View Task" when you find something that fits your schedule.',
        tip: 'Use "Browse All Tasks" to see the complete list.',
        position: "bottom"
      },
      {
        type: "spotlight",
        target: ".community-sidebar",
        title: "Stay Connected",
        body:
          "Share your thoughts through surveys and feedback forms. Your input helps us support volunteers better and improve the platform.",
        position: "bottom"
      },
      {
        type: "spotlight",
        target: ".task-details-container",
        title: "Everything You Need to Know",
        body:
          "When you open a task, you'll see completion dates, time estimates, and which organization you're helping. Filter tasks by type and status using the sidebar, or sort by deadline.",
        position: "bottom"
      },
      {
        type: "spotlight",
        target: ".profile-container",
        title: "Track Your Impact",
        body:
          "Your profile shows your contributed words, completed courses, and recognition points. Update your skills, manage notifications, and see your translation history all in one place.",
        position: "bottom"
      },
      {
        type: "modal",
        title: "You're Ready to Go",
        body:
          "Questions? Check the Resources menu for the Community Forum, Learning Center, and reference materials.",
        buttons: [
          { text: "Browse Tasks", action: "finish", type: "primary" },
          { text: "Close", action: "finish", type: "secondary" }
        ]
      }
    ];

    this.elements = {
      overlay: document.getElementById("tourOverlay"),
      modal: document.getElementById("tourModal"),
      tooltip: document.getElementById("tourTooltip"),
      spotlight: document.getElementById("tourSpotlight"),
      skip: document.getElementById("tourSkip")
    };

    this.init();
  }

  init() {
    // Always start tour for testing - comment this out in production
    setTimeout(() => this.start(), 500);

    this.elements.skip.addEventListener("click", () => this.skip());
  }

  start() {
    this.isActive = true;
    this.currentStep = 0;
    // Scroll to top before starting
    window.scrollTo({ top: 0, behavior: "smooth" });
    setTimeout(() => this.showStep(0), 300);
  }

  showStep(stepIndex) {
    const step = this.steps[stepIndex];

    if (step.type === "modal") {
      this.showModal(step);
    } else if (step.type === "spotlight") {
      this.showSpotlight(step);
    }
  }

  showModal(step) {
    this.hideAll();

    this.elements.overlay.classList.add("active");
    this.elements.modal.classList.add("active");

    this.elements.skip.style.display =
      this.currentStep === 0 || this.currentStep === this.totalSteps - 1
        ? "none"
        : "block";

    let buttonsHTML = "";
    step.buttons.forEach((btn) => {
      const btnClass =
        btn.type === "primary"
          ? "tour-btn-primary"
          : btn.type === "secondary"
          ? "tour-btn-secondary"
          : "tour-btn-text";
      buttonsHTML += `<button class="${btnClass}" onclick="tour.${btn.action}()">${btn.text}</button>`;
    });

    document.getElementById("tourContent").innerHTML = `
      <h2>${step.title}</h2>
      <p>${step.body}</p>
      <div class="tour-buttons">${buttonsHTML}</div>
    `;
  }

  showSpotlight(step) {
    this.hideAll();

    const targetElement = document.querySelector(step.target);
    if (!targetElement) {
      console.warn(`Tour target not found: ${step.target}`);
      this.next();
      return;
    }

    // Scroll element into view first
    targetElement.scrollIntoView({ behavior: "smooth", block: "center" });

    // Wait for scroll to finish before positioning
    setTimeout(() => {
      this.positionSpotlight(targetElement, step);
    }, 400);
  }

  positionSpotlight(targetElement, step) {
    this.elements.overlay.classList.add("active");
    this.elements.spotlight.classList.add("active");
    this.elements.tooltip.classList.add("active");

    // Get element position relative to document
    const rect = targetElement.getBoundingClientRect();
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const scrollLeft =
      window.pageXOffset || document.documentElement.scrollLeft;

    const spotlight = this.elements.spotlight;
    spotlight.style.top = `${rect.top + scrollTop - 8}px`;
    spotlight.style.left = `${rect.left + scrollLeft - 8}px`;
    spotlight.style.width = `${rect.width + 16}px`;
    spotlight.style.height = `${rect.height + 16}px`;

    // Position tooltip
    this.positionTooltip(step, rect, scrollTop, scrollLeft);

    // Build tooltip content
    document.getElementById("tooltipTitle").textContent = step.title;
    document.getElementById("tooltipBody").innerHTML =
      step.body + (step.tip ? `<span class="tip">${step.tip}</span>` : "");

    // Build buttons
    const buttonsContainer = document.getElementById("tooltipButtons");
    buttonsContainer.innerHTML = "";

    if (this.currentStep > 1) {
      const backBtn = document.createElement("button");
      backBtn.className = "tour-btn-secondary tour-back";
      backBtn.textContent = "‚Üê Back";
      backBtn.onclick = () => this.previous();
      buttonsContainer.appendChild(backBtn);
    }

    const nextBtn = document.createElement("button");
    nextBtn.className = "tour-btn-primary";
    nextBtn.textContent = "Next ‚Üí";
    nextBtn.onclick = () => this.next();
    buttonsContainer.appendChild(nextBtn);

    // Build progress indicator
    this.updateProgress();
  }

  positionTooltip(step, targetRect, scrollTop, scrollLeft) {
    const tooltip = this.elements.tooltip;

    let top, left;

    switch (step.position) {
      case "bottom":
        top = targetRect.bottom + scrollTop + 20;
        left = targetRect.left + scrollLeft + targetRect.width / 2 - 200;
        break;
      case "left":
        top = targetRect.top + scrollTop;
        left = targetRect.left + scrollLeft - 420;
        break;
      case "right":
        top = targetRect.top + scrollTop;
        left = targetRect.right + scrollLeft + 20;
        break;
      case "top":
      default:
        top = targetRect.top + scrollTop - 300;
        left = targetRect.left + scrollLeft + targetRect.width / 2 - 200;
    }

    // Ensure tooltip stays within viewport
    const viewportWidth = window.innerWidth;
    if (left < 20) left = 20;
    if (left + 400 > viewportWidth) left = viewportWidth - 420;

    tooltip.style.top = `${top}px`;
    tooltip.style.left = `${left}px`;
  }

  updateProgress() {
    const progressContainer = document.getElementById("tooltipProgress");
    progressContainer.innerHTML = "";

    const spotlightSteps = [1, 2, 3, 4];
    const currentSpotlightIndex = spotlightSteps.indexOf(this.currentStep);

    if (currentSpotlightIndex !== -1) {
      for (let i = 0; i < spotlightSteps.length; i++) {
        const dot = document.createElement("div");
        dot.className = "tour-progress-dot";
        if (i === currentSpotlightIndex) {
          dot.classList.add("active");
        }
        progressContainer.appendChild(dot);
      }
    }
  }

  hideAll() {
    this.elements.overlay.classList.remove("active");
    this.elements.modal.classList.remove("active");
    this.elements.tooltip.classList.remove("active");
    this.elements.spotlight.classList.remove("active");
  }

  next() {
    if (this.currentStep < this.totalSteps - 1) {
      this.currentStep++;
      this.showStep(this.currentStep);
    } else {
      this.finish();
    }
  }

  previous() {
    if (this.currentStep > 0) {
      this.currentStep--;
      this.showStep(this.currentStep);
    }
  }

  skip() {
    this.finish();
  }

  finish() {
    this.hideAll();
    this.isActive = false;
    localStorage.setItem("twb_tour_completed", "true");
  }

  restart() {
    localStorage.removeItem("twb_tour_completed");
    window.scrollTo({ top: 0, behavior: "smooth" });
    setTimeout(() => this.start(), 300);
  }
}

// Initialize tour
let tour;
document.addEventListener("DOMContentLoaded", () => {
  tour = new VirtualTour();

  // Dropdown functionality
  const resourcesToggle = document.querySelector(".resources-toggle");
  const resourcesDropdown = document.querySelector(".nav-dropdown");

  if (resourcesToggle) {
    resourcesToggle.addEventListener("click", (e) => {
      e.stopPropagation();
      resourcesDropdown.classList.toggle("open");
      document.querySelector(".user-dropdown")?.classList.remove("open");
    });
  }

  const userToggle = document.querySelector(".user-toggle");
  const userDropdown = document.querySelector(".user-dropdown");

  if (userToggle) {
    userToggle.addEventListener("click", (e) => {
      e.stopPropagation();
      userDropdown.classList.toggle("open");
      document.querySelector(".nav-dropdown")?.classList.remove("open");
    });
  }

  document.addEventListener("click", () => {
    document.querySelector(".nav-dropdown")?.classList.remove("open");
    document.querySelector(".user-dropdown")?.classList.remove("open");
  });

  document.querySelectorAll(".resources-menu, .user-menu").forEach((menu) => {
    menu.addEventListener("click", (e) => {
      e.stopPropagation();
    });
  });

  // Platform tour link
  const platformTourLink = document.querySelector(".platform-tour-link");
  if (platformTourLink) {
    platformTourLink.addEventListener("click", (e) => {
      e.preventDefault();
      document.querySelector(".nav-dropdown")?.classList.remove("open");
      if (tour) {
        tour.restart();
      }
    });
  }
});

// Expose restart function
function restartTour() {
  if (tour) {
    tour.restart();
  }
}
</script>

</body>
</html>